name: notify-admin

on:
  workflow_dispatch:
    inputs:
      message:
        description: "Mensagem para o admin (será enviada pelo WhatsApp Cloud API dev)"
        required: true
        default: "Alerta: verifique o robô de pedidos."

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send WhatsApp message (Cloud API dev)
        env:
          WA_TOKEN: ${{ secrets.WA_TOKEN }}
          WA_PHONE_NUMBER_ID: ${{ secrets.WA_PHONE_NUMBER_ID }}
          ADMIN_E164: ${{ secrets.ADMIN_E164 }}
          MSG: ${{ github.event.inputs.message }}
        run: |
          set -euo pipefail
          curl -sS -X POST "https://graph.facebook.com/v22.0/${WA_PHONE_NUMBER_ID}/messages" \
            -H "Authorization: Bearer ${WA_TOKEN}" \
            -H "Content-Type: application/json" \
            -d @- <<JSON
          {
            "messaging_product": "whatsapp",
            "to": "+${ADMIN_E164}",
            "type": "text",
            "text": { "body": "${MSG}" }
          }
          JSON
